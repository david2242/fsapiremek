"use strict";(self.webpackChunkui_challenge_opswat=self.webpackChunkui_challenge_opswat||[]).push([[898],{4898:(S,c,n)=>{n.r(c),n.d(c,{UserModule:()=>L});var u=n(9808),m=n(520),o=n(2382),e=n(1223);let g=(()=>{class t{constructor(r){this.http=r}get(){return this.http.get("http://localhost:3000/api/user")}getAll(){return this.http.get("http://localhost:3000/api/user")}update(r){return this.http.put(`http://localhost:3000/api/user/${r.email}`,r)}create(r){return this.http.post("http://localhost:3000/api/user",r)}delete(r){return this.http.delete(`http://localhost:3000/api/user/${r}`)}}return t.\u0275fac=function(r){return new(r||t)(e.LFG(m.eN))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var d=n(892),h=n(2290);function _(t,i){1&t&&(e.TgZ(0,"small",22),e._uU(1,"Please enter a valid e-mail!"),e.qZA())}function v(t,i){1&t&&(e.TgZ(0,"small",22),e._uU(1,"Username must be at least 5 characters!"),e.qZA())}function Z(t,i){if(1&t&&e._UZ(0,"img",23),2&t){const r=e.oxw();e.Q6J("src",r.currentUser.imageRef,e.LSH)}}let w=(()=>{class t{constructor(r,s,a,l,U){this.userService=r,this.auth=s,this.toastr=a,this.handler=l,this.httpClient=U,this.CLOUDINARY_URL="https://api.cloudinary.com/v1_1/ddkxkkxdt/upload",this.CLOUDINARY_UPLOAD_PRESET="vpallkqj",this.responseObj={secure_url:""},this.userForm=new o.cw({userEmail:new o.NI("",[o.kI.required,o.kI.email]),userName:new o.NI("",[o.kI.required,o.kI.minLength(5)]),userBio:new o.NI(""),userImage:new o.NI("")}),this.currentUser={username:"",email:"",bio:"",imageRef:""},this.httpClient=new m.eN(l)}ngOnInit(){localStorage.currentUser&&(this.currentUser=JSON.parse(localStorage.currentUser)),this.userForm.patchValue({userEmail:this.currentUser.email,userName:this.currentUser.username,userBio:this.currentUser.bio,userImage:this.currentUser.imageRef})}saveUserDataFromInput(){this.currentUser.username=this.userForm.value.userName,this.currentUser.email=this.userForm.value.userEmail,this.userForm.value.userBio&&(this.currentUser.bio=this.userForm.value.userBio),this.userForm.value.userImage&&(this.currentUser.imageRef=this.userForm.value.userImage)}onFileChange(r){this.imageFile=r.target.files[0],console.log(r)}updateUser(){if(this.saveUserDataFromInput(),this.imageFile){const r=new FormData;r.append("file",this.imageFile),r.append("upload_preset",this.CLOUDINARY_UPLOAD_PRESET),this.httpClient.post(this.CLOUDINARY_URL,r).subscribe(s=>{this.responseObj=s,this.currentUser.imageRef=this.responseObj.secure_url,this.updateUserTexts()})}else this.updateUserTexts()}updateUserTexts(){this.userService.update(this.currentUser).subscribe(r=>{localStorage.clear(),localStorage.setItem("currentUser",JSON.stringify(r)),this.auth.currentUserSubject.next(r),this.toastr.success("User details updated!","Success!")},r=>{this.showError(r.error)})}showError(r){this.toastr.error(r,"Error!",{enableHtml:!0,progressBar:!0})}createErrorMessage(r){return Object.values(r).join("</br>")}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(g),e.Y36(d.e),e.Y36(h._W),e.Y36(m.jN),e.Y36(m.eN))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-details"]],decls:36,vars:5,consts:[[1,"container-md"],[1,"row"],[1,"col-s-0","col-md-3"],[1,"col-s-1","col-md-6"],[1,"col"],[1,"my-3"],["action","",1,"mb-5",3,"formGroup","ngSubmit"],[1,"form-floating","mb-3"],["formControlName","userEmail","type","email","id","userEmail","placeholder","name@example.com",1,"form-control"],["for","userEmail"],["class","text-danger",4,"ngIf"],["formControlName","userName","type","text","id","userName","placeholder","Username",1,"form-control"],["for","userName"],["formControlName","userBio","id","userBio","placeholder","Bio","rows","6","maxlength","500",1,"form-control",2,"height","100%"],["for","userBio"],["readonly","","formControlName","userImage","type","text","id","userImage","placeholder","image",1,"form-control"],["for","userImage"],[1,"mb-3"],["for","userImageFile",1,"form-label"],["type","file","id","userImageFile","accept","image/*",1,"form-control",3,"change"],["class","w-50 img-thumbnail p-3 my-3","alt","",3,"src",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled"],[1,"text-danger"],["alt","",1,"w-50","img-thumbnail","p-3","my-3",3,"src"]],template:function(r,s){if(1&r&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"div",2),e.TgZ(3,"div",3)(4,"div",1)(5,"div",4)(6,"h5",5),e._uU(7,"New User"),e.qZA(),e.TgZ(8,"form",6),e.NdJ("ngSubmit",function(){return s.updateUser()}),e.TgZ(9,"div",7),e._UZ(10,"input",8),e.TgZ(11,"label",9),e._uU(12,"Email address"),e.qZA(),e.YNc(13,_,2,0,"small",10),e.qZA(),e.TgZ(14,"div",7),e._UZ(15,"input",11),e.TgZ(16,"label",12),e._uU(17,"Username"),e.qZA(),e.YNc(18,v,2,0,"small",10),e.qZA(),e.TgZ(19,"div",7),e._UZ(20,"textarea",13),e.TgZ(21,"label",14),e._uU(22,"Bio"),e.qZA()(),e.TgZ(23,"div",7),e._UZ(24,"input",15),e.TgZ(25,"label",16),e._uU(26,"Image"),e.qZA()(),e.TgZ(27,"div",17)(28,"label",18),e._uU(29,"Upload avatar image!"),e.qZA(),e.TgZ(30,"input",19),e.NdJ("change",function(l){return s.onFileChange(l)}),e.qZA()(),e.TgZ(31,"div"),e.YNc(32,Z,1,1,"img",20),e.qZA(),e.TgZ(33,"button",21),e._uU(34,"Update"),e.qZA()()()()(),e._UZ(35,"div",2),e.qZA()()),2&r){let a,l;e.xp6(8),e.Q6J("formGroup",s.userForm),e.xp6(5),e.Q6J("ngIf",(null==(a=s.userForm.get("userEmail"))?null:a.invalid)&&(null==(a=s.userForm.get("userEmail"))?null:a.dirty)),e.xp6(5),e.Q6J("ngIf",(null==(l=s.userForm.get("userName"))?null:l.invalid)&&(null==(l=s.userForm.get("userName"))?null:l.dirty)),e.xp6(14),e.Q6J("ngIf",s.currentUser.imageRef),e.xp6(1),e.Q6J("disabled",s.userForm.invalid)}},directives:[o._Y,o.JL,o.sg,o.Fj,o.JJ,o.u,u.O5,o.nD],styles:[""]}),t})();var p=n(4391);function T(t,i){1&t&&e._UZ(0,"div",4)}function b(t,i){1&t&&e._UZ(0,"div",5)}function I(t,i){1&t&&(e.TgZ(0,"div",6)(1,"button",7),e._uU(2,"Log in first!"),e.qZA()())}function A(t,i){if(1&t){const r=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._UZ(8,"img",11),e.qZA(),e.TgZ(9,"td")(10,"button",12),e.NdJ("click",function(){const l=e.CHM(r).$implicit;return e.oxw(2).onDelete(l.email)}),e._uU(11,"Delete"),e.qZA()()()}if(2&t){const r=i.$implicit;e.xp6(2),e.Oqu(r.username),e.xp6(2),e.Oqu(r.email),e.xp6(2),e.Oqu(r.bio),e.xp6(2),e.Q6J("src",r.imageRef,e.LSH)}}function N(t,i){if(1&t&&(e.TgZ(0,"div",8)(1,"table",9)(2,"thead")(3,"tr")(4,"th"),e._uU(5,"username"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"email"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"bio"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"image"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"action"),e.qZA()()(),e.TgZ(14,"tbody"),e.YNc(15,A,12,4,"tr",10),e.qZA()()()),2&t){const r=e.oxw();e.xp6(15),e.Q6J("ngForOf",r.userList)}}let C=(()=>{class t{constructor(r,s){this.userService=r,this.auth=s,this.loggedIn=this.auth.currentUserValue,this.userList=[]}ngOnInit(){this.userService.getAll().subscribe(a=>{this.userList=a});var r=document.getElementById("myModal"),s=document.getElementById("myInput");null==r||r.addEventListener("shown.bs.modal",function(){null==s||s.focus()})}onDelete(r){return console.log(r),this.auth.currentUserValue.email==r?(console.log("You cannot delete yourself!"),null):this.userService.delete(r).subscribe(s=>{console.log(s),this.ngOnInit()})}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(g),e.Y36(d.e))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-list"]],decls:4,vars:4,consts:[["style","height: 50px;",4,"ngIf"],["style","height: 150px",4,"ngIf"],["class","text-center",4,"ngIf"],["class","container-md",4,"ngIf"],[2,"height","50px"],[2,"height","150px"],[1,"text-center"],["href","#","routerLink","/user/reglog",1,"n","btn-secondary","btn-lg"],[1,"container-md"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],["alt","",2,"height","50px",3,"src"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(r,s){1&r&&(e.YNc(0,T,1,0,"div",0),e.YNc(1,b,1,0,"div",1),e.YNc(2,I,3,0,"div",2),e.YNc(3,N,16,1,"div",3)),2&r&&(e.Q6J("ngIf",s.loggedIn),e.xp6(1),e.Q6J("ngIf",!s.loggedIn),e.xp6(1),e.Q6J("ngIf",!s.loggedIn),e.xp6(1),e.Q6J("ngIf",s.loggedIn))},directives:[u.O5,p.rH,u.sg],styles:["button[_ngcontent-%COMP%]{vertical-align:center}"]}),t})();function F(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Please enter a valid e-mail!"),e.qZA())}function y(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Please enter a the password!"),e.qZA())}function q(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Please enter a valid e-mail!"),e.qZA())}function P(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Password must be at least 5 characters!"),e.qZA())}function x(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Type password again!"),e.qZA())}function E(t,i){1&t&&(e.TgZ(0,"small",25),e._uU(1,"Username must be at least 5 characters!"),e.qZA())}let f=(()=>{class t{constructor(r,s,a,l){this.auth=r,this.userService=s,this.toastr=a,this.router=l,this.userForm=new o.cw({userEmail:new o.NI("",[o.kI.required,o.kI.email]),userPassword:new o.NI("",[o.kI.required,o.kI.minLength(5)]),userPasswordAgain:new o.NI("",[o.kI.required]),userName:new o.NI("",[o.kI.required,o.kI.minLength(5)])},{}),this.loginForm=new o.cw({loginEmail:new o.NI("",[o.kI.required,o.kI.email]),loginPassword:new o.NI("",[o.kI.required,o.kI.minLength(5)])}),this.newUser={username:"",email:"",password:""}}get userEmail(){return this.userForm.get("userEmail")}get userPassword(){return this.userForm.get("userPassword")}get userPasswordAgain(){return this.userForm.get("userPasswordAgain")}get userName(){return this.userForm.get("userName")}get loginEmail(){return this.loginForm.get("loginEmail")}get loginPassword(){return this.loginForm.get("loginPassword")}ngOnInit(){}saveUserDataFromInput(){this.newUser.username=this.userForm.value.userName,this.newUser.email=this.userForm.value.userEmail,this.newUser.password=this.userForm.value.userPassword}loginUser(){this.auth.login({email:this.loginForm.value.loginEmail,password:this.loginForm.value.loginPassword}).subscribe(s=>{this.showSuccessLogin(this.auth.currentUserValue.username),this.router.navigate([""])},s=>{console.error(s),this.showError(s.error)})}regNewUser(){this.saveUserDataFromInput(),this.userService.create(this.newUser).subscribe(r=>{this.userForm.reset(),this.toastr.success("User registrated!","Congrats!")},r=>{r.error.errors&&this.showError(r.error)})}showSuccessLogin(r){this.toastr.success(`Welcome ${r}!`,"Login success!")}showError(r){this.toastr.error(r,"Error!",{enableHtml:!0,progressBar:!0})}createErrorMessage(r){return Object.values(r).join("</br>")}validHelper(r){return r.pristine?"form-control":r.invalid&&r.dirty?"form-control is-invalid":r.valid&&r.dirty?"form-control is-valid":"form-control"}smallTextHelper(r){return r.invalid&&r.dirty}passwordHelper(){return this.userPasswordAgain.pristine?"form-control":this.userPassword.value==this.userPasswordAgain.value&&this.userPasswordAgain.value?"form-control is-valid":this.userPassword.value!=this.userPasswordAgain.value&&this.userPasswordAgain.dirty?"form-control is-invalid":"form-control"}passwordSmallTextHelper(){var r,s,a;return(null===(r=this.userForm.get("userPassword"))||void 0===r?void 0:r.value)!=(null===(s=this.userForm.get("userPasswordAgain"))||void 0===s?void 0:s.value)&&(null===(a=this.userForm.get("userPasswordAgain"))||void 0===a?void 0:a.dirty)}}return t.\u0275fac=function(r){return new(r||t)(e.Y36(d.e),e.Y36(g),e.Y36(h._W),e.Y36(p.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-user-reglog"]],decls:48,vars:16,consts:[[1,"container-md"],[1,"row"],[1,"col-s-0","col-md-3"],[1,"col-s-1","col-md-6"],[1,"col"],[1,"mt-5","mb-3"],["action","",3,"formGroup","ngSubmit"],[1,"form-floating","mb-3"],["formControlName","loginEmail","type","email","id","loginEmail","placeholder","name@example.com",1,"form-control",3,"ngClass"],["for","loginEmail"],["class","text-danger",4,"ngIf"],["formControlName","loginPassword","type","password","id","loginPassword","placeholder","Password",3,"ngClass"],["for","loginPassword"],[1,"btn","btn-primary",3,"disabled"],[1,"my-5"],[1,"my-3"],["formControlName","userEmail","type","email","id","userEmail","placeholder","name@example.com",3,"ngClass"],["for","userEmail"],["formControlName","userPassword","type","password","id","userPassword","placeholder","Password",3,"ngClass"],["for","userPassword"],["formControlName","userPasswordAgain","type","password","id","userPasswordAgain","placeholder","Type password again!",3,"ngClass"],["for","userPasswordAgain"],["formControlName","userName","type","text","id","userName","placeholder","Username",3,"ngClass"],["for","userName"],[1,"btn","btn-primary","mb-5",3,"disabled"],[1,"text-danger"]],template:function(r,s){1&r&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"div",2),e.TgZ(3,"div",3)(4,"div",1)(5,"div",4)(6,"h5",5),e._uU(7,"Login"),e.qZA(),e.TgZ(8,"form",6),e.NdJ("ngSubmit",function(){return s.loginUser()}),e.TgZ(9,"div",7),e._UZ(10,"input",8),e.TgZ(11,"label",9),e._uU(12,"Email address"),e.qZA(),e.YNc(13,F,2,0,"small",10),e.qZA(),e.TgZ(14,"div",7),e._UZ(15,"input",11),e.TgZ(16,"label",12),e._uU(17,"Password"),e.qZA(),e.YNc(18,y,2,0,"small",10),e.qZA(),e.TgZ(19,"button",13),e._uU(20,"Login"),e.qZA()(),e._UZ(21,"hr",14),e.TgZ(22,"h5",15),e._uU(23,"New User"),e.qZA(),e.TgZ(24,"form",6),e.NdJ("ngSubmit",function(){return s.regNewUser()}),e.TgZ(25,"div",7),e._UZ(26,"input",16),e.TgZ(27,"label",17),e._uU(28,"Email address"),e.qZA(),e.YNc(29,q,2,0,"small",10),e.qZA(),e.TgZ(30,"div",7),e._UZ(31,"input",18),e.TgZ(32,"label",19),e._uU(33,"Password"),e.qZA(),e.YNc(34,P,2,0,"small",10),e.qZA(),e.TgZ(35,"div",7),e._UZ(36,"input",20),e.TgZ(37,"label",21),e._uU(38,"Password"),e.qZA(),e.YNc(39,x,2,0,"small",10),e.qZA(),e.TgZ(40,"div",7),e._UZ(41,"input",22),e.TgZ(42,"label",23),e._uU(43,"Username"),e.qZA(),e.YNc(44,E,2,0,"small",10),e.qZA(),e.TgZ(45,"button",24),e._uU(46,"Register"),e.qZA()()()()(),e._UZ(47,"div",2),e.qZA()()),2&r&&(e.xp6(8),e.Q6J("formGroup",s.loginForm),e.xp6(2),e.Q6J("ngClass",s.validHelper(s.loginEmail)),e.xp6(3),e.Q6J("ngIf",s.smallTextHelper(s.loginEmail)),e.xp6(2),e.Q6J("ngClass",s.validHelper(s.loginPassword)),e.xp6(3),e.Q6J("ngIf",s.smallTextHelper(s.loginPassword)),e.xp6(1),e.Q6J("disabled",s.loginForm.invalid),e.xp6(5),e.Q6J("formGroup",s.userForm),e.xp6(2),e.Q6J("ngClass",s.validHelper(s.userEmail)),e.xp6(3),e.Q6J("ngIf",s.smallTextHelper(s.userEmail)),e.xp6(2),e.Q6J("ngClass",s.validHelper(s.userPassword)),e.xp6(3),e.Q6J("ngIf",s.smallTextHelper(s.userPassword)),e.xp6(2),e.Q6J("ngClass",s.passwordHelper()),e.xp6(3),e.Q6J("ngIf",s.passwordSmallTextHelper()),e.xp6(2),e.Q6J("ngClass",s.validHelper(s.userName)),e.xp6(3),e.Q6J("ngIf",s.smallTextHelper(s.userName)),e.xp6(1),e.Q6J("disabled",s.userForm.invalid||s.passwordSmallTextHelper()))},directives:[o._Y,o.JL,o.sg,o.Fj,o.JJ,o.u,u.mk,u.O5],styles:[""]}),t})();const J=[{path:"",component:f},{path:"reglog",component:f},{path:"list",component:C},{path:"details",component:w}];let L=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[u.ez,p.Bz.forChild(J),o.UX]]}),t})()}}]);